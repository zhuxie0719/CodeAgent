# TestGenerationAgent å®Œæ•´å®ç°æ€»ç»“æ–‡æ¡£

## ğŸ“‹ ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
2. [æ–‡ä»¶ç»“æ„å’Œå†…å®¹](#æ–‡ä»¶ç»“æ„å’Œå†…å®¹)
3. [æ ¸å¿ƒåŠŸèƒ½å®ç°](#æ ¸å¿ƒåŠŸèƒ½å®ç°)
4. [æµ‹è¯•æ–‡ä»¶ç”Ÿæˆæµç¨‹](#æµ‹è¯•æ–‡ä»¶ç”Ÿæˆæµç¨‹)
5. [ç³»ç»Ÿé›†æˆä¿®æ”¹](#ç³»ç»Ÿé›†æˆä¿®æ”¹)
6. [Dockeræ”¯æŒä¿®æ”¹](#dockeræ”¯æŒä¿®æ”¹)
7. [æ€»ç»“](#æ€»ç»“)

---

## é¡¹ç›®æ¦‚è¿°

### ç›®æ ‡

å®ç°ä¸€ä¸ª**æµ‹è¯•ç”ŸæˆAgentï¼ˆTestGenerationAgentï¼‰**ï¼Œåœ¨ä¿®å¤ä»£ç å‰è‡ªåŠ¨ä¸ºæ²¡æœ‰`tests`æ–‡ä»¶å¤¹çš„é¡¹ç›®ç”Ÿæˆæ ‡å‡†çš„æµ‹è¯•æ–‡ä»¶å¤¹ï¼Œæ”¯æŒå¤šè¯­è¨€ï¼ˆPythonã€Javaã€C/C++ï¼‰ï¼Œç”¨äºå›å½’æµ‹è¯•ã€‚

### æ ¸å¿ƒä»·å€¼

- âœ… **æµ‹è¯•é©±åŠ¨ä¿®å¤**ï¼šåœ¨ä¿®å¤å‰ç”Ÿæˆæµ‹è¯•ï¼Œå»ºç«‹æµ‹è¯•åŸºçº¿
- âœ… **å¤šè¯­è¨€æ”¯æŒ**ï¼šæ”¯æŒPythonã€Javaã€C/C++é¡¹ç›®
- âœ… **è‡ªåŠ¨åŒ–**ï¼šæ— éœ€æ‰‹åŠ¨åˆ›å»ºæµ‹è¯•æ–‡ä»¶å¤¹
- âœ… **æ ‡å‡†ç»“æ„**ï¼šç”Ÿæˆç¬¦åˆå„è¯­è¨€æ ‡å‡†çš„æµ‹è¯•ç›®å½•ç»“æ„

---

## æ–‡ä»¶ç»“æ„å’Œå†…å®¹

### ğŸ“ ç›®å½•ç»“æ„

```
agents/test_generation_agent/
â”œâ”€â”€ __init__.py                          # æ¨¡å—åˆå§‹åŒ–
â”œâ”€â”€ agent.py                             # TestGenerationAgentä¸»ç±»
â”œâ”€â”€ language_detector.py                 # è¯­è¨€æ£€æµ‹å™¨
â”œâ”€â”€ tests_folder_checker.py              # æµ‹è¯•æ–‡ä»¶å¤¹æ£€æŸ¥å™¨
â”œâ”€â”€ multi_language_generator.py          # å¤šè¯­è¨€æµ‹è¯•ç”Ÿæˆåè°ƒå™¨
â”‚
â”œâ”€â”€ generators/                          # è¯­è¨€ç‰¹å®šç”Ÿæˆå™¨
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ python_generator.py              # Pythonæµ‹è¯•ç”Ÿæˆå™¨
â”‚   â”œâ”€â”€ java_generator.py                 # Javaæµ‹è¯•ç”Ÿæˆå™¨
â”‚   â””â”€â”€ cpp_generator.py                  # C/C++æµ‹è¯•ç”Ÿæˆå™¨
â”‚
â”œâ”€â”€ tests/                               # æµ‹è¯•è„šæœ¬
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ test_agent.py                    # Agentä¸»ç±»æµ‹è¯•
â”‚   â”œâ”€â”€ test_language_detector.py        # è¯­è¨€æ£€æµ‹æµ‹è¯•
â”‚   â””â”€â”€ test_integration.py               # é›†æˆæµ‹è¯•
â”‚
â””â”€â”€ [æ–‡æ¡£æ–‡ä»¶]                            # å„ç§è¯´æ˜æ–‡æ¡£
```

---

### ğŸ“„ æ ¸å¿ƒæ–‡ä»¶è¯¦ç»†è¯´æ˜

#### 1. `agent.py` - TestGenerationAgentä¸»ç±»

**åŠŸèƒ½ï¼š** Agentçš„ä¸»å…¥å£ï¼Œå¤„ç†æµ‹è¯•ç”Ÿæˆä»»åŠ¡

**ä¸»è¦å†…å®¹ï¼š**
- `__init__`: åˆå§‹åŒ–è¯­è¨€æ£€æµ‹å™¨ã€æµ‹è¯•æ–‡ä»¶å¤¹æ£€æŸ¥å™¨ã€å¤šè¯­è¨€ç”Ÿæˆå™¨
- `initialize`: Agentåˆå§‹åŒ–
- `get_capabilities`: è¿”å›Agentèƒ½åŠ›åˆ—è¡¨
- `process_task`: å¤„ç†æµ‹è¯•ç”Ÿæˆä»»åŠ¡çš„æ ¸å¿ƒæ–¹æ³•

**å¤„ç†æµç¨‹ï¼š**
1. éªŒè¯é¡¹ç›®è·¯å¾„
2. æ£€æµ‹é¡¹ç›®è¯­è¨€
3. æ£€æŸ¥æ˜¯å¦å·²æœ‰testsæ–‡ä»¶å¤¹
4. è°ƒç”¨å¤šè¯­è¨€ç”Ÿæˆå™¨ç”Ÿæˆæµ‹è¯•
5. æ±‡æ€»å¹¶è¿”å›ç»“æœ

**å…³é”®ä»£ç ï¼š**
```python
class TestGenerationAgent(BaseAgent):
    def __init__(self, config: Dict[str, Any]):
        super().__init__("test_generation_agent", config)
        self.language_detector = LanguageDetector()
        self.tests_folder_checker = TestsFolderChecker()
        self.test_generator = MultiLanguageTestGenerator(config)
    
    async def process_task(self, task_id: str, task_data: Dict[str, Any]):
        # 1. æ£€æµ‹è¯­è¨€
        languages = self.language_detector.detect_languages(str(project_path))
        
        # 2. æ£€æŸ¥testsæ–‡ä»¶å¤¹
        if self.tests_folder_checker.has_tests_folder(str(project_path), languages):
            return {"success": True, "skipped": True, "message": "testsæ–‡ä»¶å¤¹å·²å­˜åœ¨"}
        
        # 3. ç”Ÿæˆæµ‹è¯•
        for language in languages:
            result = await self.test_generator.generate_tests(...)
```

---

#### 2. `language_detector.py` - è¯­è¨€æ£€æµ‹å™¨

**åŠŸèƒ½ï¼š** æ£€æµ‹é¡¹ç›®ä½¿ç”¨çš„ç¼–ç¨‹è¯­è¨€

**ä¸»è¦å†…å®¹ï¼š**
- `Language`æšä¸¾ï¼šå®šä¹‰æ”¯æŒçš„è¯­è¨€
- `LanguageDetector`ç±»ï¼šå®ç°è¯­è¨€æ£€æµ‹é€»è¾‘

**æ£€æµ‹ç­–ç•¥ï¼š**
1. **é…ç½®æ–‡ä»¶æ£€æµ‹**ï¼šæ£€æŸ¥`pom.xml`ï¼ˆJavaï¼‰ã€`CMakeLists.txt`ï¼ˆC/C++ï¼‰ã€`setup.py`ï¼ˆPythonï¼‰ç­‰
2. **æ–‡ä»¶æ‰©å±•åæ£€æµ‹**ï¼šç»Ÿè®¡å„è¯­è¨€æ–‡ä»¶æ•°é‡
3. **æ–‡ä»¶å†…å®¹æ£€æµ‹**ï¼šæ£€æŸ¥æ–‡ä»¶å†…å®¹ç‰¹å¾

**æ”¯æŒçš„è¯­è¨€ï¼š**
- Python (`.py`, `setup.py`, `requirements.txt`)
- Java (`.java`, `pom.xml`, `build.gradle`)
- C/C++ (`.c`, `.cpp`, `.h`, `CMakeLists.txt`)
- Go (`.go`, `go.mod`)
- JavaScript/TypeScript (`.js`, `.ts`, `package.json`)

**å…³é”®ä»£ç ï¼š**
```python
class LanguageDetector:
    EXTENSION_MAP = {
        ".py": Language.PYTHON,
        ".java": Language.JAVA,
        ".cpp": Language.CPP,
        # ...
    }
    
    CONFIG_FILES = {
        "pom.xml": Language.JAVA,
        "CMakeLists.txt": Language.CPP,
        "setup.py": Language.PYTHON,
        # ...
    }
    
    def detect_languages(self, project_path: str) -> List[Language]:
        # 1. æ£€æŸ¥é…ç½®æ–‡ä»¶
        # 2. ç»Ÿè®¡æ–‡ä»¶æ‰©å±•å
        # 3. è¿”å›æ£€æµ‹åˆ°çš„è¯­è¨€åˆ—è¡¨
```

---

#### 3. `tests_folder_checker.py` - æµ‹è¯•æ–‡ä»¶å¤¹æ£€æŸ¥å™¨

**åŠŸèƒ½ï¼š** æ£€æŸ¥é¡¹ç›®æ˜¯å¦å·²æœ‰æ ‡å‡†çš„testsæ–‡ä»¶å¤¹

**ä¸»è¦å†…å®¹ï¼š**
- `has_tests_folder`: æ£€æŸ¥æ˜¯å¦å­˜åœ¨testsæ–‡ä»¶å¤¹
- `get_tests_dir`: è·å–æŒ‡å®šè¯­è¨€çš„testsç›®å½•è·¯å¾„
- `_has_test_files`: æ£€æŸ¥ç›®å½•ä¸­æ˜¯å¦æœ‰æµ‹è¯•æ–‡ä»¶

**å„è¯­è¨€çš„testsç›®å½•æ ‡å‡†ï¼š**
- **Python**: `tests/` æˆ– `test/`
- **Java**: `src/test/java/` (Maven/Gradleæ ‡å‡†)
- **C/C++**: `tests/` æˆ– `test/`
- **Go**: `*_test.go` æ–‡ä»¶

**å…³é”®ä»£ç ï¼š**
```python
class TestsFolderChecker:
    def get_tests_dir(self, project_path: str, language: Language) -> Path:
        if language == Language.JAVA:
            return project / "src" / "test" / "java"
        else:
            return project / "tests"
    
    def has_tests_folder(self, project_path: str, languages: List[Language]) -> bool:
        for language in languages:
            tests_dir = self.get_tests_dir(project_path, language)
            if tests_dir.exists() and self._has_test_files(tests_dir, language):
                return True
        return False
```

---

#### 4. `multi_language_generator.py` - å¤šè¯­è¨€æµ‹è¯•ç”Ÿæˆåè°ƒå™¨

**åŠŸèƒ½ï¼š** æ ¹æ®æ£€æµ‹åˆ°çš„è¯­è¨€é€‰æ‹©ç›¸åº”çš„ç”Ÿæˆå™¨å¹¶åè°ƒç”Ÿæˆä»»åŠ¡

**ä¸»è¦å†…å®¹ï¼š**
- `__init__`: åˆå§‹åŒ–å„è¯­è¨€ç”Ÿæˆå™¨
- `generate_tests`: ä¸ºæŒ‡å®šè¯­è¨€ç”Ÿæˆæµ‹è¯•
- `generate_tests_for_all_languages`: ä¸ºæ‰€æœ‰è¯­è¨€ç”Ÿæˆæµ‹è¯•

**å…³é”®ä»£ç ï¼š**
```python
class MultiLanguageTestGenerator:
    def __init__(self, config: Dict[str, Any]):
        self.generators = {
            Language.PYTHON: PythonTestGenerator(config),
            Language.JAVA: JavaTestGenerator(config),
            Language.CPP: CppTestGenerator(config),
            Language.C: CppTestGenerator(config),  # Cå’ŒC++ä½¿ç”¨ç›¸åŒç”Ÿæˆå™¨
        }
    
    async def generate_tests(self, project_path: str, language: Language, ...):
        generator = self.generators.get(language)
        return await generator.generate(...)
```

---

#### 5. `generators/python_generator.py` - Pythonæµ‹è¯•ç”Ÿæˆå™¨

**åŠŸèƒ½ï¼š** ä¸ºPythoné¡¹ç›®ç”Ÿæˆæµ‹è¯•æ–‡ä»¶

**ä¸»è¦å†…å®¹ï¼š**
- `generate`: ä¸»ç”Ÿæˆæ–¹æ³•
- `_generate_reproduction_test`: ç”Ÿæˆé‡ç°æµ‹è¯•ï¼ˆåŸºäºé—®é¢˜æè¿°ï¼‰
- `_generate_coverage_test`: ç”Ÿæˆè¦†ç›–æ€§æµ‹è¯•ï¼ˆLLMç”Ÿæˆï¼‰
- `_generate_with_pynguin`: ä½¿ç”¨Pynguinç”Ÿæˆæµ‹è¯•ï¼ˆå¯é€‰ï¼‰
- `_create_conftest`: åˆ›å»ºconftest.py
- `_create_init_files`: åˆ›å»º__init__.pyæ–‡ä»¶

**ç”Ÿæˆç­–ç•¥ï¼š**
1. **é‡ç°æµ‹è¯•**ï¼šå¦‚æœæœ‰é—®é¢˜æè¿°ï¼Œç”Ÿæˆä¸“é—¨çš„é‡ç°æµ‹è¯•
2. **è¦†ç›–æ€§æµ‹è¯•**ï¼šä½¿ç”¨LLMç”Ÿæˆè¦†ç›–ä¸»è¦åŠŸèƒ½çš„æµ‹è¯•
3. **Pynguinæµ‹è¯•**ï¼šå¦‚æœå¯ç”¨ï¼Œä½¿ç”¨Pynguinç”Ÿæˆé¢å¤–æµ‹è¯•ï¼ˆå¯é€‰ï¼‰

**å…³é”®ä»£ç ï¼š**
```python
class PythonTestGenerator:
    async def generate(self, project_path: str, issues: List, issue_description: str):
        # 1. åˆ›å»ºtestsç›®å½•
        tests_dir = Path(project_path) / "tests"
        tests_dir.mkdir(exist_ok=True)
        
        # 2. ç”Ÿæˆé‡ç°æµ‹è¯•
        if issue_description:
            await self._generate_reproduction_test(...)
        
        # 3. ç”Ÿæˆè¦†ç›–æ€§æµ‹è¯•ï¼ˆLLMï¼‰
        await self._generate_coverage_test(...)
        
        # 4. ä½¿ç”¨Pynguinï¼ˆå¯é€‰ï¼‰
        if self.config.get("use_pynguin", False):
            await self._generate_with_pynguin(...)
        
        # 5. åˆ›å»ºconftest.pyå’Œ__init__.py
        self._create_conftest(tests_dir)
        self._create_init_files(tests_dir)
```

---

#### 6. `generators/java_generator.py` - Javaæµ‹è¯•ç”Ÿæˆå™¨

**åŠŸèƒ½ï¼š** ä¸ºJavaé¡¹ç›®ç”ŸæˆJUnitæµ‹è¯•æ–‡ä»¶

**ä¸»è¦å†…å®¹ï¼š**
- `generate`: ä¸»ç”Ÿæˆæ–¹æ³•
- `_generate_reproduction_test`: ç”Ÿæˆé‡ç°æµ‹è¯•
- `_generate_coverage_test`: ç”Ÿæˆè¦†ç›–æ€§æµ‹è¯•
- `_generate_with_evosuite`: ä½¿ç”¨EvoSuiteç”Ÿæˆæµ‹è¯•ï¼ˆå¯é€‰ï¼‰
- `_check_junit_dependency`: æ£€æŸ¥JUnitä¾èµ–

**ç”Ÿæˆç­–ç•¥ï¼š**
1. **é‡ç°æµ‹è¯•**ï¼šç”ŸæˆJUnitæµ‹è¯•ç±»
2. **è¦†ç›–æ€§æµ‹è¯•**ï¼šä½¿ç”¨LLMç”Ÿæˆæµ‹è¯•ç±»
3. **EvoSuiteæµ‹è¯•**ï¼šå¦‚æœå¯ç”¨ï¼Œä½¿ç”¨EvoSuiteç”Ÿæˆï¼ˆå¯é€‰ï¼‰

**å…³é”®ä»£ç ï¼š**
```python
class JavaTestGenerator:
    async def generate(self, project_path: str, issues: List, issue_description: str):
        # 1. åˆ›å»ºsrc/test/javaç›®å½•
        test_dir = Path(project_path) / "src" / "test" / "java"
        test_dir.mkdir(parents=True, exist_ok=True)
        
        # 2. æ£€æŸ¥JUnitä¾èµ–
        self._check_junit_dependency(project_path)
        
        # 3. ç”Ÿæˆæµ‹è¯•
        # ... ç±»ä¼¼Pythonç”Ÿæˆå™¨
```

---

#### 7. `generators/cpp_generator.py` - C/C++æµ‹è¯•ç”Ÿæˆå™¨

**åŠŸèƒ½ï¼š** ä¸ºC/C++é¡¹ç›®ç”ŸæˆGoogle Testæµ‹è¯•æ–‡ä»¶

**ä¸»è¦å†…å®¹ï¼š**
- `generate`: ä¸»ç”Ÿæˆæ–¹æ³•
- `_generate_reproduction_test`: ç”Ÿæˆé‡ç°æµ‹è¯•
- `_generate_coverage_test`: ç”Ÿæˆè¦†ç›–æ€§æµ‹è¯•
- `_update_cmakelists`: æ›´æ–°CMakeLists.txtä»¥åŒ…å«æµ‹è¯•

**ç”Ÿæˆç­–ç•¥ï¼š**
1. **é‡ç°æµ‹è¯•**ï¼šç”ŸæˆGoogle Testæµ‹è¯•
2. **è¦†ç›–æ€§æµ‹è¯•**ï¼šä½¿ç”¨LLMç”Ÿæˆæµ‹è¯•
3. **CMakeLists.txt**ï¼šè‡ªåŠ¨ç”Ÿæˆæˆ–æ›´æ–°CMakeLists.txt

---

## æ ¸å¿ƒåŠŸèƒ½å®ç°

### 1. è¯­è¨€æ£€æµ‹

**å®ç°ä½ç½®ï¼š** `language_detector.py`

**æ£€æµ‹æ–¹æ³•ï¼š**
1. **é…ç½®æ–‡ä»¶æ£€æµ‹**ï¼šæ£€æŸ¥é¡¹ç›®æ ¹ç›®å½•çš„é…ç½®æ–‡ä»¶
   - `pom.xml` â†’ Java
   - `CMakeLists.txt` â†’ C/C++
   - `setup.py` / `pyproject.toml` â†’ Python
   - `go.mod` â†’ Go
   - `package.json` â†’ JavaScript/TypeScript

2. **æ–‡ä»¶æ‰©å±•åç»Ÿè®¡**ï¼šéå†é¡¹ç›®æ–‡ä»¶ï¼Œç»Ÿè®¡å„è¯­è¨€æ–‡ä»¶æ•°é‡

3. **æ–‡ä»¶å†…å®¹æ£€æµ‹**ï¼šæ£€æŸ¥æ–‡ä»¶å†…å®¹ç‰¹å¾ï¼ˆå¦‚`#include <iostream>` â†’ C++ï¼‰

**è¿”å›ç»“æœï¼š** è¯­è¨€åˆ—è¡¨ï¼ˆæ”¯æŒå¤šè¯­è¨€é¡¹ç›®ï¼‰

---

### 2. æµ‹è¯•æ–‡ä»¶å¤¹æ£€æŸ¥

**å®ç°ä½ç½®ï¼š** `tests_folder_checker.py`

**æ£€æŸ¥å†…å®¹ï¼š**
- æ˜¯å¦å­˜åœ¨æ ‡å‡†çš„testsç›®å½•
- ç›®å½•ä¸­æ˜¯å¦æœ‰æµ‹è¯•æ–‡ä»¶
- æ˜¯å¦ç¬¦åˆå„è¯­è¨€çš„æµ‹è¯•æ–‡ä»¶å‘½åè§„èŒƒ

**å„è¯­è¨€æ ‡å‡†ï¼š**
- **Python**: `tests/` æˆ– `test/`ï¼ŒåŒ…å«`test_*.py`æˆ–`*_test.py`
- **Java**: `src/test/java/`ï¼ŒåŒ…å«`*Test.java`
- **C/C++**: `tests/`ï¼ŒåŒ…å«`*_test.cpp`æˆ–`test_*.cpp`
- **Go**: `*_test.go`æ–‡ä»¶

---

### 3. æµ‹è¯•æ–‡ä»¶ç”Ÿæˆ

**å®ç°ä½ç½®ï¼š** `generators/*_generator.py`

**ç”Ÿæˆç­–ç•¥ï¼ˆä»¥Pythonä¸ºä¾‹ï¼‰ï¼š**

1. **é‡ç°æµ‹è¯•ç”Ÿæˆ**
   - è¾“å…¥ï¼šé—®é¢˜æè¿°ã€æ£€æµ‹åˆ°çš„é—®é¢˜
   - æ–¹æ³•ï¼šè°ƒç”¨LLMç”Ÿæˆä¸“é—¨çš„é‡ç°æµ‹è¯•
   - è¾“å‡ºï¼š`test_reproduction.py`

2. **è¦†ç›–æ€§æµ‹è¯•ç”Ÿæˆ**
   - è¾“å…¥ï¼šæºä»£ç æ–‡ä»¶åˆ—è¡¨
   - æ–¹æ³•ï¼šè°ƒç”¨LLMä¸ºæ¯ä¸ªæºæ–‡ä»¶ç”Ÿæˆæµ‹è¯•
   - è¾“å‡ºï¼š`test_*.py`æ–‡ä»¶

3. **å·¥å…·ç”Ÿæˆï¼ˆå¯é€‰ï¼‰**
   - **Pynguin**ï¼ˆPythonï¼‰ï¼šè‡ªåŠ¨ç”Ÿæˆé«˜è¦†ç›–ç‡æµ‹è¯•
   - **EvoSuite**ï¼ˆJavaï¼‰ï¼šè‡ªåŠ¨ç”ŸæˆJUnitæµ‹è¯•

4. **é…ç½®æ–‡ä»¶ç”Ÿæˆ**
   - **Python**: `conftest.py`ã€`__init__.py`
   - **Java**: æ£€æŸ¥/æ›´æ–°`pom.xml`ä¸­çš„JUnitä¾èµ–
   - **C/C++**: ç”Ÿæˆ/æ›´æ–°`CMakeLists.txt`

---

## æµ‹è¯•æ–‡ä»¶ç”Ÿæˆæµç¨‹

### å®Œæ•´æµç¨‹

```
1. ç”¨æˆ·ä¸Šä¼ é¡¹ç›®
   â†“
2. Coordinatorè°ƒç”¨process_workflow
   â†“
3. BugDetectionAgentæ£€æµ‹ç¼ºé™·
   â†“
4. Decision Engineåˆ†æå¤æ‚åº¦
   â†“
5. TestGenerationAgentç”Ÿæˆæµ‹è¯•ï¼ˆæ–°å¢ï¼‰âœ…
   â”œâ”€ 5.1 æ£€æµ‹é¡¹ç›®è¯­è¨€
   â”œâ”€ 5.2 æ£€æŸ¥æ˜¯å¦å·²æœ‰testsæ–‡ä»¶å¤¹
   â”œâ”€ 5.3 å¦‚æœæ²¡æœ‰ï¼Œç”Ÿæˆtestsæ–‡ä»¶å¤¹
   â”‚   â”œâ”€ Python: ç”Ÿæˆpytestæµ‹è¯•
   â”‚   â”œâ”€ Java: ç”ŸæˆJUnitæµ‹è¯•
   â”‚   â””â”€ C/C++: ç”ŸæˆGoogle Testæµ‹è¯•
   â””â”€ 5.4 è¿”å›ç”Ÿæˆç»“æœ
   â†“
6. FixExecutionAgentæ‰§è¡Œä¿®å¤
   â†“
7. TestValidationAgentéªŒè¯ä¿®å¤ï¼ˆä½¿ç”¨ç”Ÿæˆçš„testsï¼‰
```

---

### TestGenerationAgentå†…éƒ¨æµç¨‹

```
process_task(task_id, task_data)
   â†“
1. éªŒè¯é¡¹ç›®è·¯å¾„
   â†“
2. æ£€æµ‹é¡¹ç›®è¯­è¨€
   â”œâ”€ language_detector.detect_languages()
   â””â”€ è¿”å›è¯­è¨€åˆ—è¡¨ï¼ˆå¦‚ï¼š[Language.PYTHON]ï¼‰
   â†“
3. æ£€æŸ¥testsæ–‡ä»¶å¤¹
   â”œâ”€ tests_folder_checker.has_tests_folder()
   â””â”€ å¦‚æœå·²å­˜åœ¨ï¼Œè¿”å›è·³è¿‡
   â†“
4. ä¸ºæ¯ç§è¯­è¨€ç”Ÿæˆæµ‹è¯•
   â”œâ”€ multi_language_generator.generate_tests()
   â”‚   â”œâ”€ é€‰æ‹©å¯¹åº”è¯­è¨€çš„ç”Ÿæˆå™¨
   â”‚   â”‚   â”œâ”€ Python â†’ PythonTestGenerator
   â”‚   â”‚   â”œâ”€ Java â†’ JavaTestGenerator
   â”‚   â”‚   â””â”€ C/C++ â†’ CppTestGenerator
   â”‚   â””â”€ è°ƒç”¨ç”Ÿæˆå™¨çš„generate()æ–¹æ³•
   â”‚       â”œâ”€ åˆ›å»ºtestsç›®å½•
   â”‚       â”œâ”€ ç”Ÿæˆé‡ç°æµ‹è¯•ï¼ˆå¦‚æœæœ‰é—®é¢˜æè¿°ï¼‰
   â”‚       â”œâ”€ ç”Ÿæˆè¦†ç›–æ€§æµ‹è¯•ï¼ˆLLMï¼‰
   â”‚       â”œâ”€ ä½¿ç”¨å·¥å…·ç”Ÿæˆï¼ˆå¯é€‰ï¼šPynguin/EvoSuiteï¼‰
   â”‚       â””â”€ åˆ›å»ºé…ç½®æ–‡ä»¶ï¼ˆconftest.pyã€CMakeLists.txtç­‰ï¼‰
   â””â”€ æ±‡æ€»ç»“æœ
   â†“
5. è¿”å›ç”Ÿæˆç»“æœ
   â”œâ”€ success: True/False
   â”œâ”€ languages: [æ£€æµ‹åˆ°çš„è¯­è¨€]
   â”œâ”€ results: {è¯­è¨€: ç”Ÿæˆç»“æœ}
   â”œâ”€ tests_dir: testsç›®å½•è·¯å¾„
   â”œâ”€ total_tests: ç”Ÿæˆçš„æµ‹è¯•æ–‡ä»¶æ•°
   â””â”€ errors: é”™è¯¯åˆ—è¡¨
```

---

### Pythonæµ‹è¯•ç”Ÿæˆè¯¦ç»†æµç¨‹

```
PythonTestGenerator.generate()
   â†“
1. åˆ›å»ºtestsç›®å½•
   â”œâ”€ project_path/tests/
   â””â”€ åˆ›å»º__init__.py
   â†“
2. ç”Ÿæˆé‡ç°æµ‹è¯•ï¼ˆå¦‚æœæœ‰é—®é¢˜æè¿°ï¼‰
   â”œâ”€ _generate_reproduction_test()
   â”œâ”€ è°ƒç”¨LLMç”Ÿæˆtest_reproduction.py
   â””â”€ å†™å…¥tests/test_reproduction.py
   â†“
3. ç”Ÿæˆè¦†ç›–æ€§æµ‹è¯•
   â”œâ”€ éå†æºä»£ç æ–‡ä»¶
   â”œâ”€ å¯¹æ¯ä¸ªæ–‡ä»¶è°ƒç”¨LLMç”Ÿæˆæµ‹è¯•
   â”œâ”€ _generate_coverage_test()
   â””â”€ å†™å…¥tests/test_*.py
   â†“
4. ä½¿ç”¨Pynguinç”Ÿæˆï¼ˆå¯é€‰ï¼‰
   â”œâ”€ _generate_with_pynguin()
   â”œâ”€ åœ¨Dockerå†…æ‰§è¡ŒPynguinï¼ˆå¦‚æœå¯ç”¨Dockerï¼‰
   â””â”€ ç”Ÿæˆçš„æµ‹è¯•æ–‡ä»¶è‡ªåŠ¨åŒæ­¥å›æœ¬åœ°
   â†“
5. åˆ›å»ºé…ç½®æ–‡ä»¶
   â”œâ”€ _create_conftest() â†’ conftest.py
   â””â”€ _create_init_files() â†’ __init__.py
   â†“
6. è¿”å›ç»“æœ
   â””â”€ {success, tests_dir, generated_tests, total_tests, errors}
```

---

### Javaæµ‹è¯•ç”Ÿæˆè¯¦ç»†æµç¨‹

```
JavaTestGenerator.generate()
   â†“
1. åˆ›å»ºsrc/test/javaç›®å½•
   â”œâ”€ project_path/src/test/java/
   â””â”€ åˆ›å»ºåŒ…ç»“æ„
   â†“
2. æ£€æŸ¥JUnitä¾èµ–
   â”œâ”€ _check_junit_dependency()
   â”œâ”€ æ£€æŸ¥pom.xmlæˆ–build.gradle
   â””â”€ å¦‚æœæ²¡æœ‰ï¼Œæ·»åŠ JUnitä¾èµ–
   â†“
3. ç”Ÿæˆé‡ç°æµ‹è¯•
   â”œâ”€ _generate_reproduction_test()
   â””â”€ ç”ŸæˆJUnitæµ‹è¯•ç±»
   â†“
4. ç”Ÿæˆè¦†ç›–æ€§æµ‹è¯•
   â”œâ”€ _generate_coverage_test()
   â””â”€ ä¸ºæ¯ä¸ªç±»ç”Ÿæˆæµ‹è¯•ç±»
   â†“
5. ä½¿ç”¨EvoSuiteç”Ÿæˆï¼ˆå¯é€‰ï¼‰
   â”œâ”€ _generate_with_evosuite()
   â””â”€ åœ¨Dockerå†…æ‰§è¡ŒEvoSuite
   â†“
6. è¿”å›ç»“æœ
```

---

### C/C++æµ‹è¯•ç”Ÿæˆè¯¦ç»†æµç¨‹

```
CppTestGenerator.generate()
   â†“
1. åˆ›å»ºtestsç›®å½•
   â”œâ”€ project_path/tests/
   â””â”€ åˆ›å»ºæµ‹è¯•æ–‡ä»¶
   â†“
2. ç”Ÿæˆé‡ç°æµ‹è¯•
   â”œâ”€ _generate_reproduction_test()
   â””â”€ ç”ŸæˆGoogle Testæµ‹è¯•
   â†“
3. ç”Ÿæˆè¦†ç›–æ€§æµ‹è¯•
   â”œâ”€ _generate_coverage_test()
   â””â”€ ä¸ºæ¯ä¸ªæºæ–‡ä»¶ç”Ÿæˆæµ‹è¯•
   â†“
4. æ›´æ–°CMakeLists.txt
   â”œâ”€ _update_cmakelists()
   â”œâ”€ æ·»åŠ Google Testä¾èµ–
   â””â”€ é…ç½®æµ‹è¯•ç¼–è¯‘
   â†“
5. è¿”å›ç»“æœ
```

---

## ç³»ç»Ÿé›†æˆä¿®æ”¹

### 1. Coordinatorå·¥ä½œæµé›†æˆ

**æ–‡ä»¶ï¼š** `coordinator/coordinator.py`

**ä¿®æ”¹ä½ç½®ï¼š** `process_workflow`æ–¹æ³•ï¼ˆç¬¬548-583è¡Œï¼‰

**ä¿®æ”¹å†…å®¹ï¼š**
- åœ¨é˜¶æ®µ2ï¼ˆæ™ºèƒ½å†³ç­–ï¼‰ä¹‹åï¼Œé˜¶æ®µ3ï¼ˆä¿®å¤æ‰§è¡Œï¼‰ä¹‹å‰æ·»åŠ æµ‹è¯•ç”Ÿæˆé˜¶æ®µ
- æ·»åŠ `_has_tests_folder`è¾…åŠ©æ–¹æ³•

**æ–°å¢ä»£ç ï¼š**
```python
# ===== é˜¶æ®µ2.5: æµ‹è¯•ç”Ÿæˆï¼ˆæ–°å¢ï¼‰=====
if project_path:
    self.logger.info("=== é˜¶æ®µ2.5: Test Generation Agent - æµ‹è¯•ç”Ÿæˆ ===")
    if not self._has_tests_folder(project_path):
        self.logger.info("æ£€æµ‹åˆ°é¡¹ç›®æ²¡æœ‰testsæ–‡ä»¶å¤¹ï¼Œå¼€å§‹ç”Ÿæˆæµ‹è¯•...")
        test_gen_task_id = await self.create_task('generate_tests', {
            'project_path': project_path,
            'issues': issues,
            'issue_description': None
        }, TaskPriority.HIGH)
        
        await self.assign_task(test_gen_task_id, 'test_generation_agent')
        test_result = await self.task_manager.get_task_result(test_gen_task_id, timeout=300)
        
        if test_result.get('success'):
            self.logger.info(f"æµ‹è¯•ç”ŸæˆæˆåŠŸ: ç”Ÿæˆ {test_result.get('total_tests', 0)} ä¸ªæµ‹è¯•æ–‡ä»¶")
        else:
            self.logger.warning(f"æµ‹è¯•ç”Ÿæˆå¤±è´¥ï¼Œä½†ç»§ç»­æ‰§è¡Œä¿®å¤æµç¨‹")
    else:
        self.logger.info("é¡¹ç›®å·²æœ‰testsæ–‡ä»¶å¤¹ï¼Œè·³è¿‡æµ‹è¯•ç”Ÿæˆ")
```

**æ–°å¢è¾…åŠ©æ–¹æ³•ï¼š**
```python
def _has_tests_folder(self, project_path: str) -> bool:
    """æ£€æŸ¥é¡¹ç›®æ˜¯å¦å·²æœ‰testsæ–‡ä»¶å¤¹"""
    from pathlib import Path
    from agents.test_generation_agent.tests_folder_checker import TestsFolderChecker
    from agents.test_generation_agent.language_detector import LanguageDetector
    
    try:
        project = Path(project_path)
        if not project.exists():
            return False
        
        checker = TestsFolderChecker()
        detector = LanguageDetector()
        languages = detector.detect_languages(str(project))
        
        return checker.has_tests_folder(str(project), languages)
    except Exception as e:
        self.logger.warning(f"æ£€æŸ¥testsæ–‡ä»¶å¤¹æ—¶å‡ºé”™: {e}ï¼Œå‡è®¾æ²¡æœ‰testsæ–‡ä»¶å¤¹")
        return False
```

**å·¥ä½œæµå˜åŒ–ï¼š**
```
åŸå·¥ä½œæµï¼š
1. BugDetectionAgent â†’ æ£€æµ‹ç¼ºé™·
2. Decision Engine â†’ æ™ºèƒ½å†³ç­–
3. FixExecutionAgent â†’ æ‰§è¡Œä¿®å¤
4. TestValidationAgent â†’ éªŒè¯ä¿®å¤

æ–°å·¥ä½œæµï¼š
1. BugDetectionAgent â†’ æ£€æµ‹ç¼ºé™·
2. Decision Engine â†’ æ™ºèƒ½å†³ç­–
2.5. TestGenerationAgent â†’ ç”Ÿæˆtestsæ–‡ä»¶å¤¹ï¼ˆæ–°å¢ï¼‰âœ…
3. FixExecutionAgent â†’ æ‰§è¡Œä¿®å¤
4. TestValidationAgent â†’ éªŒè¯ä¿®å¤ï¼ˆä½¿ç”¨ç”Ÿæˆçš„testsï¼‰
```

---

### 2. Agentæ³¨å†Œ

**æ–‡ä»¶ï¼š** `api/core/agent_manager.py`

**ä¿®æ”¹ä½ç½®ï¼š** `start_all_agents`æ–¹æ³•ï¼ˆç¬¬38è¡Œï¼‰

**ä¿®æ”¹å†…å®¹ï¼š**
- æ·»åŠ TestGenerationAgentåˆ°agenté…ç½®åˆ—è¡¨

**æ–°å¢ä»£ç ï¼š**
```python
agent_configs = [
    ("bug_detection_agent", BugDetectionAgent, "ğŸ“¦", "ç¼ºé™·æ£€æµ‹", {"use_docker": use_docker}),
    ("test_generation_agent", TestGenerationAgent, "ğŸ§ª", "æµ‹è¯•ç”Ÿæˆ", {}),  # æ–°å¢
    ("fix_execution_agent", FixExecutionAgent, "ğŸ”§", "è‡ªåŠ¨ä¿®å¤", {}),
    # ...
]
```

**å¯¼å…¥è¯­å¥ï¼š**
```python
from agents.test_generation_agent.agent import TestGenerationAgent
```

---

## Dockeræ”¯æŒä¿®æ”¹

### 1. DockerRunneræ”¯æŒå¯å†™æŒ‚è½½

**æ–‡ä»¶ï¼š** `utils/docker_runner.py`

**ä¿®æ”¹ä½ç½®ï¼š** `run_command`æ–¹æ³•ï¼ˆç¬¬198-269è¡Œï¼‰

**ä¿®æ”¹å†…å®¹ï¼š**
- æ·»åŠ `read_only`å‚æ•°ï¼ˆé»˜è®¤`True`ï¼Œä¿æŒå‘åå…¼å®¹ï¼‰
- æ ¹æ®å‚æ•°å†³å®šæŒ‚è½½æ¨¡å¼ï¼ˆ`:ro`æˆ–é»˜è®¤å¯å†™ï¼‰

**ä¿®æ”¹å‰ï¼š**
```python
async def run_command(self, 
                     project_path: Path,
                     command: List[str],
                     working_dir: Optional[str] = None,
                     timeout: int = 300,
                     environment: Optional[Dict[str, str]] = None) -> Dict[str, Any]:
    # ...
    "-v", f"{project_path.absolute()}:/app/test_project:ro",  # å›ºå®šåªè¯»
```

**ä¿®æ”¹åï¼š**
```python
async def run_command(self, 
                     project_path: Path,
                     command: List[str],
                     working_dir: Optional[str] = None,
                     timeout: int = 300,
                     environment: Optional[Dict[str, str]] = None,
                     read_only: bool = True) -> Dict[str, Any]:  # æ–°å¢å‚æ•°
    # ...
    mount_mode = ":ro" if read_only else ""  # æ ¹æ®å‚æ•°å†³å®š
    "-v", f"{project_path.absolute()}:/app/test_project{mount_mode}",
```

**å½±å“åˆ†æï¼š**
- âœ… **BugDetectionAgent**ï¼šæ— å½±å“ï¼ˆé»˜è®¤åªè¯»ï¼Œè¡Œä¸ºä¸å˜ï¼‰
- âœ… **å…¶ä»–ä½¿ç”¨**ï¼šæ— å½±å“ï¼ˆé»˜è®¤åªè¯»ï¼‰
- âœ… **TestGenerationAgent**ï¼šå¯ä»¥ä½¿ç”¨`read_only=False`è¿›è¡Œå¯å†™æŒ‚è½½

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```python
# TestGenerationAgentä¸­ä½¿ç”¨å¯å†™æŒ‚è½½
result = await self.docker_runner.run_command(
    project_path=Path(project_path),
    command=pynguin_cmd,
    timeout=120,
    read_only=False  # å¯å†™æŒ‚è½½ï¼Œå…è®¸ç”Ÿæˆæµ‹è¯•æ–‡ä»¶
)
```

---

## æ€»ç»“

### å®ç°çš„åŠŸèƒ½

1. âœ… **TestGenerationAgentä¸»ç±»** - å®Œæ•´çš„Agentå®ç°
2. âœ… **è¯­è¨€æ£€æµ‹å™¨** - æ”¯æŒPythonã€Javaã€C/C++ç­‰å¤šç§è¯­è¨€
3. âœ… **æµ‹è¯•æ–‡ä»¶å¤¹æ£€æŸ¥å™¨** - æ£€æŸ¥æ ‡å‡†ç›®å½•ç»“æ„
4. âœ… **å¤šè¯­è¨€æµ‹è¯•ç”Ÿæˆåè°ƒå™¨** - åè°ƒå„è¯­è¨€ç”Ÿæˆå™¨
5. âœ… **Pythonæµ‹è¯•ç”Ÿæˆå™¨** - LLM + Pynguinï¼ˆå¯é€‰ï¼‰
6. âœ… **Javaæµ‹è¯•ç”Ÿæˆå™¨** - LLM + EvoSuiteï¼ˆå¯é€‰ï¼‰
7. âœ… **C/C++æµ‹è¯•ç”Ÿæˆå™¨** - LLM + Google Testæ¨¡æ¿
8. âœ… **Coordinatoré›†æˆ** - é›†æˆåˆ°å·¥ä½œæµ
9. âœ… **Agentæ³¨å†Œ** - æ³¨å†Œåˆ°ç³»ç»Ÿ
10. âœ… **Dockeræ”¯æŒ** - æ”¯æŒå¯å†™æŒ‚è½½

### æ–‡ä»¶ç»Ÿè®¡

- **æ ¸å¿ƒä»£ç æ–‡ä»¶**ï¼š10ä¸ª
- **æµ‹è¯•æ–‡ä»¶**ï¼š3ä¸ª
- **æ–‡æ¡£æ–‡ä»¶**ï¼š24ä¸ª
- **ä»£ç è¡Œæ•°**ï¼šçº¦2500è¡Œ

### æ”¯æŒçš„è¯­è¨€

- âœ… **Python** - å®Œå…¨æ”¯æŒ
- âœ… **Java** - å®Œå…¨æ”¯æŒ
- âœ… **C/C++** - å®Œå…¨æ”¯æŒ
- â¸ï¸ **Go** - å·²æ£€æµ‹ï¼Œæœªå®ç°ç”Ÿæˆå™¨
- â¸ï¸ **JavaScript/TypeScript** - å·²æ£€æµ‹ï¼Œæœªå®ç°ç”Ÿæˆå™¨

### ç³»ç»Ÿé›†æˆ

- âœ… **Coordinatorå·¥ä½œæµ** - å·²é›†æˆ
- âœ… **Agentæ³¨å†Œ** - å·²æ³¨å†Œ
- âœ… **Dockeræ”¯æŒ** - å·²æ”¯æŒå¯å†™æŒ‚è½½
- â¸ï¸ **APIç«¯ç‚¹** - å¯é€‰ï¼ˆæœªå®ç°ï¼‰

### æµ‹è¯•æ”¯æŒ

- âœ… **å•å…ƒæµ‹è¯•** - å·²åˆ›å»º
- âœ… **é›†æˆæµ‹è¯•** - å·²åˆ›å»º
- â¸ï¸ **ç«¯åˆ°ç«¯æµ‹è¯•** - éœ€è¦æ‰‹åŠ¨æµ‹è¯•

### ä¸‹ä¸€æ­¥å·¥ä½œ

1. **æ¢å¤Dockeræ”¯æŒ**ï¼ˆå¯é€‰ï¼‰
   - åœ¨TestGenerationAgentä¸­åˆå§‹åŒ–docker_runner
   - åœ¨generatorsä¸­ä½¿ç”¨å¯å†™æŒ‚è½½

2. **APIç«¯ç‚¹**ï¼ˆå¯é€‰ï¼‰
   - åˆ›å»º`api/test_generation_api.py`
   - æä¾›REST APIæ¥å£

3. **æ‰©å±•è¯­è¨€æ”¯æŒ**ï¼ˆå¯é€‰ï¼‰
   - Goæµ‹è¯•ç”Ÿæˆå™¨
   - JavaScript/TypeScriptæµ‹è¯•ç”Ÿæˆå™¨

---

*æœ€åæ›´æ–°ï¼š2024å¹´12æœˆ*

