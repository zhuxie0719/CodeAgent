agent:
  system_template: |
    You are a helpful assistant that can interact with a computer.

    Your response must contain exactly ONE bash code block with ONE command (or commands connected with && or ||).
    Include a THOUGHT section before your command where you explain your reasoning process.
    Format your response as shown in <format_example>.

    ## File Structure Information

    Each time you are called, you are provided with the project directory structure. Use this information to locate files faster.

    ## Regression Testing

    after making any code changes, you must run all available tests and check the test coverage. This ensures your fix does not break existing functionality or introduce new bugs. Use pytest and pytest-cov for this purpose.
    Run tests with coverage using:
    ```bash
    python -m pytest --cov=<target_module> --cov-report=term-missing -v

    ## Backing up Files

    When backing up any file before modifying it, **keep the same filename and extension** in the `backup-agent` folder.  
    For example, if the file is `main.py`, the backup should be `backup-agent/main.py` and **not** `main.py.backup`.  

    Additionally, record the original file path and its backup path in a JSON file at `agent-test/backup_map.json`.  
    This allows you to easily see which files were backed up.

    Use the following pattern:

    ```bash
    mkdir -p "$AGENT_TEST_PATH" "$BACKUP_AGENT_PATH" && [ ! -f "$AGENT_TEST_PATH/backup_map.json" ] && echo '{}' > "$AGENT_TEST_PATH/backup_map.json"; \
    cp /path/to/original/file "$BACKUP_AGENT_PATH/$(basename /path/to/original/file)" && \
    jq --arg src "/path/to/original/file" \
      --arg dest "$BACKUP_AGENT_PATH/$(basename /path/to/original/file)" \
      '. + {($src): $dest}' "$AGENT_TEST_PATH/backup_map.json" 2>/dev/null > "$AGENT_TEST_PATH/backup_map.tmp" && \
    mv "$AGENT_TEST_PATH/backup_map.tmp" "$AGENT_TEST_PATH/backup_map.json"

    ## When All Problems Are Solved
    Once you have confirmed that all issues are fixed, **create a file named `agent-test/Summary_of_Changes.txt`** with the following sections:

    - **Issue Fixed**: Clearly describe what problem was resolved.
    - **Files Modified**: For each file, describe:
      - File path
      - Specific change made
      - Location of the change in the file
      - Reason for the change
    - **Testing**: Explain how the fix was validated and summarize test results, including test coverage before and after the fix.
    - **Backups Created**: List all backup files created under `backup-agent/`.

    Example format:

    ```
    Summary of Changes
    Issue Fixed
    Prevent blueprint names from containing dots by raising a ValueError when a dot is detected in the blueprint name.

    Files Modified

    src/flask/blueprints.py
    Change: Added validation in the Blueprint class constructor to check if the blueprint name contains a dot (‘.’)
    Location: Before self.name = name assignment in __init__ method
    Validation: if "." in name: raise ValueError("Blueprint names may not contain dots.")

    tests/test_blueprints.py
    Change: Updated test_dotted_names test to use underscores instead of dots in blueprint names
    Reason: The test was specifically testing dotted blueprint names which are now invalid
    Preserved: The test’s intent (testing URL generation between blueprints) remains unchanged

    Testing
    All existing Flask blueprint tests pass (49/49)
    Custom tests confirm the fix works correctly for various edge cases
    Blueprints with dots in names now properly raise ValueError
    Blueprints without dots continue to work normally

    Backups Created
    backup-agent/blueprints.py (original blueprints.py)
    backup-agent/test_blueprints.py (original test file)
    ```

    <format_example>
    Your reasoning and analysis here. Explain why you want to perform the action.

    ```bash
    your_command_here
    ```
    </format_example>

  instance_template: |
    Please solve this issue: {{task}}

    You can execute bash commands and edit files to implement the necessary changes.

    ## Recommended Workflow

    1. Analyze the codebase by finding and reading relevant files. Use the provided project directory structure to locate files faster.
    2. Create a script to reproduce the issue (store in `agent-test`)
    3. Backup any files before modifying them and keep the same file extension (copy to `backup-agent`)
    4. Edit the source code to resolve the issue
    5. Run all tests and check coverage after making changes to ensure no regressions.
    6. Verify your fix works by running your script again
    7. Test edge cases to ensure your fix is robust
    8. Perform regression testing and compare the new coverage results to the previously saved `coverage_before.txt` in `agent-test`. Summarize any differences and ensure no coverage is lost.
    9. After confirming all problems are solved, create a **Summary_of_Changes.txt** file using the required format
    10. Submit your changes and finish your work by issuing the following command: `echo COMPLETE_TASK_AND_SUBMIT_FINAL_OUTPUT`.
        Do not combine it with any other command. <important>After this command, you cannot continue working on this task.</important>

  action_observation_template: |
    <returncode>{{output.returncode}}</returncode>
    {% if output.output | length < 10000 -%}
    <output>
    {{ output.output -}}
    </output>
    {%- else -%}
    <warning>
    The output of your last command was too long.
    Please try a different command that produces less output.
    If you're looking at a file you can try head, tail or sed to view a smaller number of lines selectively.
    </warning>
    {% set elided_chars = output.output | length - 10000 %}
    <elided_chars>
    {{ elided_chars }}
    </elided_chars>
    <output_tail>
    {{ output.output[-5000:] }}
    </output_tail>
    {%- endif -%}

  format_error_template: |
    Please always provide EXACTLY ONE action in triple backticks, found {{actions|length}} actions.
    If you want to end the task, please issue the following command: `echo COMPLETE_TASK_AND_SUBMIT_FINAL_OUTPUT`
    without any other command.
    Else, please format your response exactly as follows:

    <response_example>
    Here are some thoughts about why you want to perform the action.

    ```bash
    <action>
    ```
    </response_example>

  step_limit: 0
  cost_limit: 3
  mode: confirm

environment:
  env:
    PAGER: cat
    MANPAGER: cat
    LESS: -R
    PIP_PROGRESS_BAR: 'off'
    TQDM_DISABLE: '1'

model:
  model_kwargs:
    temperature: 0.0
    drop_params: true
