# ä»£ç åˆ†æAgent (Code Analysis Agent)

## æ¦‚è¿°

ä»£ç åˆ†æAgentæ˜¯ä¸€ä¸ªå¼ºå¤§çš„ä»£ç åˆ†æå·¥å…·ï¼Œæä¾›æ·±å±‚æ¬¡çš„ä»£ç ç†è§£ã€ä¾èµ–åˆ†æã€å¤æ‚åº¦è¯„ä¼°å’ŒAIé©±åŠ¨çš„é¡¹ç›®æ„å›¾åˆ†æã€‚å®ƒèƒ½å¤Ÿè‡ªåŠ¨åˆ†æé¡¹ç›®ç»“æ„ã€ä»£ç è´¨é‡ã€ä¾èµ–å…³ç³»ï¼Œå¹¶ç”Ÿæˆç»“æ„åŒ–çš„é¡¹ç›®ä¿¡æ¯ã€‚

## ä¸»è¦åŠŸèƒ½

### ğŸ” é¡¹ç›®ç»“æ„åˆ†æ
- **æ–‡ä»¶åˆ†ç±»**: è‡ªåŠ¨è¯†åˆ«ä»£ç æ–‡ä»¶ã€é…ç½®æ–‡ä»¶ã€æµ‹è¯•æ–‡ä»¶ã€æ–‡æ¡£æ–‡ä»¶
- **é¡¹ç›®å…ƒæ•°æ®**: æ£€æµ‹é¡¹ç›®ç±»å‹ã€æ¡†æ¶ã€ç¼–ç¨‹è¯­è¨€
- **æ–‡ä»¶ç»Ÿè®¡**: ç»Ÿè®¡æ–‡ä»¶æ•°é‡ã€ä»£ç è¡Œæ•°ã€æ–‡ä»¶ç±»å‹åˆ†å¸ƒ
- **ç›®å½•ç»“æ„**: ç”Ÿæˆé¡¹ç›®æ–‡ä»¶æ ‘ç»“æ„

### ğŸ“Š ä»£ç è´¨é‡åˆ†æ
- **å¤æ‚åº¦è¯„ä¼°**: è®¡ç®—åœˆå¤æ‚åº¦ã€è®¤çŸ¥å¤æ‚åº¦ã€åµŒå¥—æ·±åº¦
- **å¯ç»´æŠ¤æ€§æŒ‡æ ‡**: åŸºäºå¤šä¸ªç»´åº¦è®¡ç®—å¯ç»´æŠ¤æ€§åˆ†æ•°
- **ä»£ç é—®é¢˜æ£€æµ‹**: è¯†åˆ«è¯­æ³•é”™è¯¯ã€ä»£ç é£æ ¼é—®é¢˜ã€æ½œåœ¨ç¼ºé™·
- **å¤šè¯­è¨€æ”¯æŒ**: æ”¯æŒPythonã€JavaScriptã€TypeScriptã€Javaã€C/C++ã€Goã€Rustç­‰

### ğŸ”— ä¾èµ–å…³ç³»åˆ†æ
- **åŒ…ç®¡ç†å™¨æ”¯æŒ**: æ”¯æŒrequirements.txtã€package.jsonã€Cargo.tomlã€pom.xmlã€go.mod
- **å¯¼å…¥ä¾èµ–**: åˆ†æä»£ç ä¸­çš„import/requireè¯­å¥
- **å¾ªç¯ä¾èµ–æ£€æµ‹**: ä½¿ç”¨å›¾ç®—æ³•æ£€æµ‹å¾ªç¯ä¾èµ–
- **ä¾èµ–æŒ‡æ ‡**: è®¡ç®—ä¾èµ–è€¦åˆåº¦ã€ä¾èµ–æ·±åº¦ç­‰æŒ‡æ ‡

### ğŸ¤– AIæ™ºèƒ½åˆ†æ
- **ä»£ç æ„å›¾ç†è§£**: ä½¿ç”¨DeepSeek AIåˆ†æä»£ç åŠŸèƒ½å’Œæ„å›¾
- **é¡¹ç›®æ‘˜è¦ç”Ÿæˆ**: è‡ªåŠ¨ç”Ÿæˆé¡¹ç›®æ•´ä½“åˆ†ææ‘˜è¦
- **æ¶æ„æ¨¡å¼è¯†åˆ«**: è¯†åˆ«MVCã€å¾®æœåŠ¡ã€åˆ†å±‚æ¶æ„ç­‰æ¨¡å¼
- **æ”¹è¿›å»ºè®®**: æä¾›ä»£ç ä¼˜åŒ–å’Œé‡æ„å»ºè®®

### ğŸ“ˆ é¡¹ç›®æ„å›¾åˆ†æ
- **é¡¹ç›®ç±»å‹æ¨æ–­**: è‡ªåŠ¨è¯†åˆ«Webåº”ç”¨ã€APIæœåŠ¡ã€å‰ç«¯åº”ç”¨ç­‰
- **æŠ€æœ¯æ ˆè¯†åˆ«**: æ£€æµ‹ä½¿ç”¨çš„æ¡†æ¶å’Œåº“
- **å…³é”®ç‰¹æ€§æå–**: è¯†åˆ«æ•°æ®åº“é›†æˆã€ç”¨æˆ·è®¤è¯ã€APIæ¥å£ç­‰ç‰¹æ€§
- **å¤æ‚åº¦ç­‰çº§è¯„ä¼°**: è¯„ä¼°é¡¹ç›®æ•´ä½“å¤æ‚åº¦

## æŠ€æœ¯æ¶æ„

### æ ¸å¿ƒç»„ä»¶

1. **ProjectAnalyzer**: é¡¹ç›®ç»“æ„åˆ†æå™¨
   - æ–‡ä»¶ç³»ç»Ÿéå†
   - é¡¹ç›®å…ƒæ•°æ®æå–
   - æ–‡ä»¶åˆ†ç±»å’Œç»Ÿè®¡

2. **CodeAnalyzer**: ä»£ç è´¨é‡åˆ†æå™¨
   - ASTè§£æå’Œå¤æ‚åº¦è®¡ç®—
   - å¤šè¯­è¨€ä»£ç åˆ†æ
   - é—®é¢˜æ£€æµ‹å’ŒæŠ¥å‘Š

3. **DependencyAnalyzer**: ä¾èµ–å…³ç³»åˆ†æå™¨
   - åŒ…ç®¡ç†å™¨æ–‡ä»¶è§£æ
   - ä»£ç å¯¼å…¥åˆ†æ
   - å›¾ç®—æ³•å¾ªç¯ä¾èµ–æ£€æµ‹

4. **AIAnalysisService**: AIåˆ†ææœåŠ¡
   - DeepSeek APIé›†æˆ
   - ä»£ç æ„å›¾åˆ†æ
   - é¡¹ç›®æ‘˜è¦ç”Ÿæˆ

### æ•°æ®æ¨¡å‹

```python
@dataclass
class CodeComplexityMetrics:
    cyclomatic_complexity: int
    cognitive_complexity: int
    lines_of_code: int
    function_count: int
    class_count: int
    nested_depth: int
    parameter_count: int

@dataclass
class ProjectIntent:
    project_type: str
    main_purpose: str
    key_features: List[str]
    architecture_pattern: str
    technology_stack: List[str]
    complexity_level: str
    maintainability_score: float
```

## APIæ¥å£

### åŸºç¡€åˆ†ææ¥å£
```http
POST /api/code-analysis/analyze
Content-Type: application/json

{
    "project_path": "/path/to/project",
    "analysis_depth": "comprehensive",
    "include_ai_analysis": true,
    "include_dependency_graph": true
}
```

### æ–‡ä»¶ä¸Šä¼ åˆ†æ
```http
POST /api/code-analysis/analyze-upload
Content-Type: multipart/form-data

files: [file1, file2, ...]
include_ai_analysis: true
analysis_depth: "comprehensive"
```

### è·å–åˆ†æç»“æœ
```http
GET /api/code-analysis/summary/{analysis_id}
GET /api/code-analysis/quality/{analysis_id}
GET /api/code-analysis/dependencies/{analysis_id}
GET /api/code-analysis/ai-analysis/{analysis_id}
```

## ä½¿ç”¨æ–¹æ³•

### 1. å®‰è£…ä¾èµ–
```bash
pip install -r requirements.txt
```

### 2. å¯åŠ¨APIæœåŠ¡
```bash
python start_code_analysis_api.py
```

### 3. ä½¿ç”¨Python API
```python
import asyncio
from agents.code_analysis_agent.agent import CodeAnalysisAgent

async def analyze_project():
    config = {
        'deepseek_api_key': 'your-api-key',
        'ai_analysis_enabled': True
    }
    
    agent = CodeAnalysisAgent(config)
    await agent.start()
    
    result = await agent.analyze_project('/path/to/project')
    
    print(f"é¡¹ç›®ç±»å‹: {result['project_intent']['project_type']}")
    print(f"å¤æ‚åº¦ç­‰çº§: {result['project_intent']['complexity_level']}")
    print(f"å¯ç»´æŠ¤æ€§åˆ†æ•°: {result['project_intent']['maintainability_score']}")
    
    await agent.stop()

# è¿è¡Œåˆ†æ
asyncio.run(analyze_project())
```

### 4. ä½¿ç”¨å‰ç«¯ç•Œé¢
1. æ‰“å¼€ `frontend/code_analysis.html`
2. è¾“å…¥é¡¹ç›®è·¯å¾„æˆ–ä¸Šä¼ æ–‡ä»¶
3. é€‰æ‹©åˆ†ææ·±åº¦å’Œé€‰é¡¹
4. ç‚¹å‡»"å¼€å§‹åˆ†æ"
5. æŸ¥çœ‹è¯¦ç»†åˆ†æç»“æœ

## é…ç½®é€‰é¡¹

### Agenté…ç½®
```python
config = {
    'deepseek_api_key': 'your-deepseek-api-key',
    'max_file_size': 10 * 1024 * 1024,  # 10MB
    'supported_languages': ['python', 'javascript', 'typescript', 'java'],
    'ai_analysis_enabled': True
}
```

### åˆ†ææ·±åº¦é€‰é¡¹
- **basic**: åŸºç¡€åˆ†æï¼Œä»…åŒ…å«æ–‡ä»¶ç»“æ„å’ŒåŸºæœ¬ç»Ÿè®¡
- **standard**: æ ‡å‡†åˆ†æï¼ŒåŒ…å«ä»£ç è´¨é‡å’Œä¾èµ–åˆ†æ
- **comprehensive**: å…¨é¢åˆ†æï¼ŒåŒ…å«AIåˆ†æå’Œé¡¹ç›®æ„å›¾æ¨æ–­

## è¾“å‡ºç¤ºä¾‹

### é¡¹ç›®ç»“æ„åˆ†æ
```json
{
    "project_structure": {
        "files": [...],
        "code_files": [...],
        "test_files": [...],
        "total_lines": 1250,
        "project_metadata": {
            "name": "my-project",
            "type": "python",
            "framework": "fastapi",
            "language": "python"
        }
    }
}
```

### ä»£ç è´¨é‡åˆ†æ
```json
{
    "code_quality": {
        "complexity": {
            "main.py": {
                "cyclomatic_complexity": 8,
                "cognitive_complexity": 12,
                "lines_of_code": 150,
                "function_count": 5,
                "class_count": 2
            }
        },
        "overall_metrics": {
            "average_complexity": 6.5,
            "average_maintainability": 78.3,
            "total_issues": 12,
            "error_count": 2,
            "warning_count": 8
        }
    }
}
```

### é¡¹ç›®æ„å›¾åˆ†æ
```json
{
    "project_intent": {
        "project_type": "web_application",
        "main_purpose": "APIæœåŠ¡å¼€å‘",
        "key_features": ["RESTful API", "ç”¨æˆ·è®¤è¯", "æ•°æ®åº“é›†æˆ"],
        "architecture_pattern": "MVCæ¨¡å¼",
        "technology_stack": ["Python", "FastAPI", "SQLAlchemy"],
        "complexity_level": "ä¸­ç­‰",
        "maintainability_score": 75.5,
        "confidence": 0.85
    }
}
```

## æµ‹è¯•

è¿è¡Œæµ‹è¯•è„šæœ¬éªŒè¯åŠŸèƒ½ï¼š
```bash
python test_code_analysis_agent.py
```

## æ‰©å±•æ€§

### æ·»åŠ æ–°è¯­è¨€æ”¯æŒ
1. åœ¨ `CodeAnalyzer` ä¸­æ·»åŠ æ–°çš„åˆ†ææ–¹æ³•
2. å®ç°å¯¹åº”çš„ASTè§£æå’Œå¤æ‚åº¦è®¡ç®—
3. æ›´æ–°æ–‡ä»¶ç±»å‹æ£€æµ‹é€»è¾‘

### æ·»åŠ æ–°çš„åˆ†ææŒ‡æ ‡
1. æ‰©å±• `CodeComplexityMetrics` æ•°æ®ç±»
2. åœ¨ç›¸åº”çš„åˆ†æå™¨ä¸­å®ç°è®¡ç®—é€»è¾‘
3. æ›´æ–°å‰ç«¯å±•ç¤ºç•Œé¢

### é›†æˆå…¶ä»–AIæœåŠ¡
1. å®ç°æ–°çš„AIåˆ†ææœåŠ¡ç±»
2. åœ¨ `AIAnalysisService` ä¸­æ·»åŠ æ–°çš„åˆ†ææ–¹æ³•
3. æ›´æ–°é…ç½®å’ŒAPIæ¥å£

## æ€§èƒ½ä¼˜åŒ–

- **å¹¶è¡Œåˆ†æ**: ä½¿ç”¨ `asyncio.gather()` å¹¶è¡Œæ‰§è¡Œå¤šä¸ªåˆ†æä»»åŠ¡
- **ç¼“å­˜æœºåˆ¶**: å¯¹é‡å¤åˆ†æçš„ç»“æœè¿›è¡Œç¼“å­˜
- **å¢é‡åˆ†æ**: åªåˆ†æå˜æ›´çš„æ–‡ä»¶
- **èµ„æºé™åˆ¶**: é™åˆ¶åŒæ—¶åˆ†æçš„æ–‡ä»¶æ•°é‡å’Œå¤§å°

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **NetworkXå¯¼å…¥é”™è¯¯**
   ```bash
   pip install networkx==3.2.1
   ```

2. **AIåˆ†æå¤±è´¥**
   - æ£€æŸ¥DeepSeek APIå¯†é’¥æ˜¯å¦æ­£ç¡®
   - ç¡®è®¤ç½‘ç»œè¿æ¥æ­£å¸¸
   - æ£€æŸ¥APIé…é¢æ˜¯å¦å……è¶³

3. **æ–‡ä»¶è§£æé”™è¯¯**
   - ç¡®è®¤æ–‡ä»¶ç¼–ç ä¸ºUTF-8
   - æ£€æŸ¥æ–‡ä»¶æ˜¯å¦æŸå
   - éªŒè¯æ–‡ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡®

### æ—¥å¿—è°ƒè¯•
```python
import logging
logging.basicConfig(level=logging.DEBUG)
```

## è´¡çŒ®æŒ‡å—

1. Forké¡¹ç›®ä»“åº“
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
3. æäº¤ä»£ç æ›´æ”¹
4. åˆ›å»ºPull Request

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨MITè®¸å¯è¯ï¼Œè¯¦è§LICENSEæ–‡ä»¶ã€‚

## æ›´æ–°æ—¥å¿—

### v2.0.0
- æ–°å¢AIæ™ºèƒ½åˆ†æåŠŸèƒ½
- å¢å¼ºä¾èµ–å…³ç³»åˆ†æ
- æ·»åŠ é¡¹ç›®æ„å›¾æ¨æ–­
- æ”¯æŒå¤šè¯­è¨€ä»£ç åˆ†æ
- ä¼˜åŒ–å‰ç«¯ç•Œé¢

### v1.0.0
- åŸºç¡€é¡¹ç›®ç»“æ„åˆ†æ
- ç®€å•ä»£ç è´¨é‡æ£€æµ‹
- åŸºæœ¬ä¾èµ–å…³ç³»åˆ†æ
