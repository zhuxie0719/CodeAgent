# ä»£ç è´¨é‡åˆ†æAgent

## åŠŸèƒ½æ¦‚è¿°

ä»£ç è´¨é‡åˆ†æAgentä¸“æ³¨äºå•æ–‡ä»¶åˆ†æï¼Œæä¾›å…¨é¢çš„ä»£ç è´¨é‡è¯„ä¼°å’ŒAIé©±åŠ¨çš„è¯¦ç»†æŠ¥å‘Šç”Ÿæˆã€‚

## ä¸»è¦åŠŸèƒ½

### 1. ä»£ç é£æ ¼æ£€æŸ¥
- **è¡Œé•¿åº¦æ£€æŸ¥**: æ£€æŸ¥ä»£ç è¡Œé•¿åº¦ï¼Œé»˜è®¤é™åˆ¶120å­—ç¬¦
- **å‘½åè§„èŒƒæ£€æŸ¥**: éªŒè¯å‡½æ•°åï¼ˆå°å†™ä¸‹åˆ’çº¿ï¼‰ã€ç±»åï¼ˆå¤§é©¼å³°ï¼‰ã€å˜é‡å
- **ç¼©è¿›ä¸€è‡´æ€§æ£€æŸ¥**: æ£€æµ‹æ··åˆä½¿ç”¨åˆ¶è¡¨ç¬¦å’Œç©ºæ ¼
- **æ³¨é‡Šè¦†ç›–ç‡**: è®¡ç®—æ³¨é‡Šè¦†ç›–ç‡ï¼Œå»ºè®®æœ€ä½³å®è·µ
- **å¯¼å…¥é¡ºåºæ£€æŸ¥**: éªŒè¯å¯¼å…¥è¯­å¥é¡ºåºï¼ˆæ ‡å‡†åº“ã€ç¬¬ä¸‰æ–¹åº“ã€æœ¬åœ°åº“ï¼‰

### 2. è´¨é‡æŒ‡æ ‡è®¡ç®—
- **åŸºç¡€ç»Ÿè®¡**: ä»£ç è¡Œæ•°ã€æ³¨é‡Šè¡Œæ•°ã€ç©ºç™½è¡Œæ•°
- **ç»“æ„åˆ†æ**: å‡½æ•°æ•°é‡ã€ç±»æ•°é‡ã€å¹³å‡å‡½æ•°é•¿åº¦
- **å¤æ‚åº¦åˆ†æ**: åœˆå¤æ‚åº¦ã€å¤æ‚åº¦è¯„åˆ†
- **å¯ç»´æŠ¤æ€§è¯„åˆ†**: åŸºäºå¤šä¸ªå› ç´ çš„ç»¼åˆæ€§è¯„åˆ†
- **å¯è¯»æ€§è¯„åˆ†**: è¯„ä¼°ä»£ç çš„å¯è¯»æ€§æ°´å¹³

### 3. AIè´¨é‡æŠ¥å‘Šç”Ÿæˆ
- **æ€»ä½“è¯„åˆ†**: 0-100åˆ†çš„ç»¼åˆè´¨é‡è¯„åˆ†
- **ç­‰çº§åˆ’åˆ†**: Aã€Bã€Cã€Dã€Fäº”ä¸ªç­‰çº§
- **è¯¦ç»†è¯„åˆ†**: 7ä¸ªç»´åº¦çš„è¯¦ç»†è¯„åˆ†
  - ä»£ç é£æ ¼ (15åˆ†)
  - ä»£ç ç»“æ„ (20åˆ†)
  - æ€§èƒ½æ•ˆç‡ (15åˆ†)
  - å®‰å…¨æ€§ (15åˆ†)
  - å¯ç»´æŠ¤æ€§ (15åˆ†)
  - å¯æµ‹è¯•æ€§ (10åˆ†)
  - æ–‡æ¡£è´¨é‡ (10åˆ†)
- **AIæ´å¯Ÿ**: ä»£ç ä¼˜åŠ¿ã€æ”¹è¿›å»ºè®®ã€æ€»ä½“è¯„ä»·

## ä½¿ç”¨æ–¹æ³•

### æ–¹å¼ä¸€ï¼šé€šè¿‡Webç•Œé¢

1. **å¯åŠ¨æœåŠ¡**
   ```bash
   python start_api.py  # å¯åŠ¨APIæœåŠ¡å™¨
   ```

2. **ä¸Šä¼ æ–‡ä»¶**
   - æ‰“å¼€æµè§ˆå™¨è®¿é—® `http://localhost:8001`
   - é€‰æ‹©"ğŸ¤– AIè´¨é‡åˆ†æ"å¤é€‰æ¡†
   - ä¸Šä¼ ä½ çš„ä»£ç æ–‡ä»¶
   - ç‚¹å‡»"å¼€å§‹æ£€æµ‹"

3. **æŸ¥çœ‹ç»“æœ**
   - ç­‰å¾…åˆ†æå®Œæˆ
   - åœ¨main.htmlé¡µé¢åº•éƒ¨æŸ¥çœ‹AIè´¨é‡æŠ¥å‘Š
   - å¯ä»¥ä¸‹è½½æˆ–æŸ¥çœ‹è¯¦ç»†æŠ¥å‘Š

### æ–¹å¼äºŒï¼šé€šè¿‡APIæ¥å£

```python
import requests

# åˆ†æä»£ç æ–‡ä»¶
response = requests.post(
    "http://localhost:8001/api/code-quality/analyze-file",
    json={
        "file_content": "your_code_here",
        "file_path": "example.py",
        "include_ai_analysis": True
    }
)

result = response.json()
print(f"æ€»ä½“è¯„åˆ†: {result['data']['ai_report']['overall_score']}")
```

###  wayä¸‰ï¼šç›´æ¥ä½¿ç”¨Agent

```python
import asyncio
from agents.code_quality_agent import CodeQualityAgent

async def analyze_code():
    config = {
        'ai_api_key': 'your-deepseek-api-key',
        'max_line_length': 120
    }
    
    agent = CodeQualityAgent(config)
    await agent.start()
    
    # åˆ†ææ–‡ä»¶
    result = await agent.analyze_single_file(
        'test.py', 
        'your_code_content'
    )
    
    print(f"è¯„åˆ†: {result['ai_report']['overall_score']}")
    print(f"ç­‰çº§: {result['ai_report']['grade']}")

asyncio.run(analyze_code())
```

## æ”¯æŒçš„ç¼–ç¨‹è¯­è¨€

- **Python** (.py) - å®Œæ•´æ”¯æŒ
- **JavaScript** (.js) - åŸºç¡€æ”¯æŒ
- **Java** (.java) - åŸºç¡€æ”¯æŒ
- **C/C++** (.c, .cpp, .h) - åŸºç¡€æ”¯æŒ
- **C#** (.cs) - åŸºç¡€æ”¯æŒ

## APIæ¥å£

### åŸºç¡€ç«¯ç‚¹
- `GET /api/code-quality/health` - å¥åº·æ£€æŸ¥
- `GET /api/code-quality/capabilities` - è·å–Agentèƒ½åŠ›
- `GET /api/code-quality/metrics` - è·å–AgentæŒ‡æ ‡

### åˆ†æç«¯ç‚¹
- `POST /api/code-quality/analyze-file` - åˆ†ææ–‡ä»¶å†…å®¹
- `POST /api/code-quality/analyze-upload` - åˆ†æä¸Šä¼ çš„æ–‡ä»¶
- `POST /api/code-quality/analyze-file-path` - åˆ†ææ–‡ä»¶è·¯å¾„

### è¯·æ±‚ç¤ºä¾‹

```json
{
  "file_content": "def hello():\n    print('Hello World')",
  "file_path": "hello.py",
  "include_ai_analysis": true
}
```

### å“åº”ç¤ºä¾‹

```json
{
  "success": true,
  "data": {
    "file_path": "hello.py",
    "file_size": 50,
    "analysis_time": "2024-01-01T12:00:00",
    "style_issues": [
      {
        "type": "naming",
        "severity": "warning",
        "line": 1,
        "message": "å‡½æ•°åå»ºè®®æ›´åŠ æè¿°æ€§",
        "suggestion": "å»ºè®®ä½¿ç”¨æ›´å…·ä½“çš„å‡½æ•°å"
      }
    ],
    "metrics": {
      "lines_of_code": 2,
      "comment_lines": 0,
      "complexity_score": 2.0,
      "maintainability_score": 8.5
    },
    "ai_report": {
      "overall_score": 85,
      "grade": "B",
      "detailed_scores": {
        "style": 13,
        "structure": 18,
        "performance": 12
      },
      "strengths": ["ä»£ç ç®€æ´æ˜“æ‡‚"],
      "suggestions": ["æ·»åŠ æ³¨é‡Šæ–‡æ¡£"],
      "summary": "ä»£ç è´¨é‡è‰¯å¥½ï¼Œå»ºè®®æ”¹è¿›æ–‡æ¡£"
    }
  }
}
```

## é…ç½®é€‰é¡¹

```python
config = {
    'ai_api_key': 'your-deepseek-api-key',      # AIåˆ†æAPIå¯†é’¥
    'ai_base_url': 'https://api.deepseek.com/v1/chat/completions',  # AI APIåœ°å€
    'max_line_length': 120,                     # è¡Œé•¿åº¦é™åˆ¶
    'max_workers': 1                           # æœ€å¤§å·¥ä½œçº¿ç¨‹æ•°
}
```

## æ³¨æ„äº‹é¡¹

1. **AIåˆ†æ**: éœ€è¦æœ‰æ•ˆçš„DeepSeek APIå¯†é’¥æ‰èƒ½ä½¿ç”¨AIåŠŸèƒ½
2. **å¤‡ç”¨æŠ¥å‘Š**: æ²¡æœ‰APIå¯†é’¥æ—¶ä¼šä½¿ç”¨åŸºäºè§„åˆ™çš„åŸºç¡€æŠ¥å‘Š
3. **æ–‡ä»¶å¤§å°**: å»ºè®®å•æ–‡ä»¶ä¸è¶…è¿‡10MB
4. **ç½‘ç»œ**: AIåˆ†æéœ€è¦ç½‘ç»œè¿æ¥åˆ°DeepSeek API

## æµ‹è¯•

è¿è¡Œæµ‹è¯•è„šæœ¬éªŒè¯åŠŸèƒ½ï¼š

```bash
python test_quality_agent.py    # æµ‹è¯•Agentæ ¸å¿ƒåŠŸèƒ½
python test_quality_api.py      # æµ‹è¯•APIæ¥å£ï¼ˆéœ€è¦æœåŠ¡å™¨è¿è¡Œï¼‰
```

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **å¯¼å…¥é”™è¯¯**: ç¡®ä¿å®‰è£…äº†æ‰€æœ‰ä¾èµ–
   ```bash
   pip install -r requirements.txt
   ```

2. **AIåˆ†æå¤±è´¥**: æ£€æŸ¥APIå¯†é’¥å’Œç½‘ç»œè¿æ¥

3. **åˆ†æç»“æœä¸å‡†ç¡®**: ç¡®ä¿ä»£ç æ–‡ä»¶ç¼–ç ä¸ºUTF-8

### æ—¥å¿—ä¿¡æ¯

Agentä¼šè¾“å‡ºè¯¦ç»†çš„æ—¥å¿—ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼š
- åˆ†æè¿›åº¦
- é”™è¯¯ä¿¡æ¯
- æ€§èƒ½æŒ‡æ ‡

## æ‰©å±•å¼€å‘

### æ·»åŠ æ–°çš„æ£€æŸ¥è§„åˆ™

åœ¨`quality_checker.py`ä¸­çš„`StyleChecker`ç±»æ·»åŠ æ–°æ–¹æ³•ï¼š

```python
def _check_new_rule(self, file_content: str) -> List[Dict[str, Any]]:
    """æ£€æŸ¥æ–°è§„åˆ™"""
    issues = []
    # å®ç°æ£€æŸ¥é€»è¾‘
    return issues
```

### æ·»åŠ æ–°çš„è´¨é‡æŒ‡æ ‡

åœ¨`QualityMetricsCalculator`ç±»ä¸­æ·»åŠ æ–°æŒ‡æ ‡ï¼š

```python
async def calculate_metrics(self, file_path: str, file_content: str) -> Dict[str, Any]:
    metrics = await super().calculate_metrics(file_path, file_content)
    
    # æ·»åŠ æ–°æŒ‡æ ‡
    metrics['new_metric'] = self._calculate_new_metric(file_content)
    
    return metrics
```

---

**æ³¨æ„**: è¿™æ˜¯ä¸€ä¸ªä¸“æ³¨äºå•æ–‡ä»¶åˆ†æçš„ç‰ˆæœ¬ã€‚å¯¹äºé¡¹ç›®çº§åˆ«çš„åˆ†æï¼Œå»ºè®®ä½¿ç”¨å…¶ä»–åˆ†æå·¥å…·ç»„åˆã€‚
